;     MI'S DIR V5.5;;BY Ò.×. (ÂOB K7) ËOBER;      FOR ÍÉÌÁÄÙ;    ÊULY 19, 1986;; ÁS USED IN SEQ-SORT.V1;      ÍAY 13, 1989;; ÏRIGINALLY WRITTEN IN ÐÁÌ; ÃONVERTED TO ÅÂÕÄ 64;;.DIS;.DIS P.ORG $C800 ;DEC 51200;;--- EQUATES ---;;CLRSCN = $E544 ;BASIC'S CLR/HOMELINPRT = $BDCD ;OUTPUT A NUMBERSETLFS = $FFBA ;SET LOGICAL FILE #SETNAM = $FFBD ;SET FILE NAMECHROUT = $FFD2 ;OUTOUT A CHARACTERCLOSE = $FFC3 ;CLOSE FILECHKIN = $FFC6 ;SET CHANNEL FOR INPUTCLALL = $FFE7 ;CLOSE ALL CHANNELSCHRIN = $FFCF ;INPUT A CHARACTEROPEN = $FFC0 ;OPEN A FILECURLIN = $D6 ;CURRENT CRSR LINEMATRIX = $CB ;KEYPRESS MATRIXNDX = $C6 ;# OF CHARACTERS IN BUFFERPLOT = $FFF0 ;SET CRSR ROUTINECLRLINE = $E9FF ;CLEAR SCREEN LINEBGCOLO = $D021 ;BACKGROUND COLOREXTCOL = $D020 ;BORDER COLORCOLOR = $0286 ;CHARACTER COLORDOLSIGN = $A360 ;LOCATION OF ROM '$'TABLE = $8000 ;WORKING FILENAM TABLEFILNAME = $0244 ;BASIC GETS FN HEREMENUFLG = $0256 ;BASIC FLAG FOR MENUHOME = $E566 ;HOME THE CRSRNOFILE = $0257 ;# OF SEQ FILES FOUND;;--- PROGRAM STARTS HERE ---;LDA BGCOLO ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"PHA ;       SAVE CURRENT SCREENLDA EXTCOL; COLORS TO RESTOREPHA ;       AT THE END OF THELDA COLOR ; ROUTINE.PHA ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"START LDA #0STA BGCOLO ;SET SCREEN COLORS FORLDA #0STA STPCNTSTA NOFILESTA EXTCOL ;THIS ROUTINE.LDA #7STA COLOR ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR CLRSCN ;CLEAR THE SCREENINIT JSR CLALL ;RESET ALL I/O'SJSR HOME ;HOME THE CRSRLDA #146 ;TURN THE REVERSED PRINTJSR CHROUT ;OFF.LDA #0 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"STA INDEX1STA FIRSTQ ;SET ALL VARIABLESSTA INDEX2 ;USED IN THE ROUTINESTA DIREND ;TO ZERO.STA NOLINESTA MENUFLG ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #8   ;SET UP LOGICAL FILETAX      ;NUMBER 8.LDY #0JSR SETLFS ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #1     ;    SET UP FILE NAMEDLDY #>DOLSIGN ; '$' FOR DIRECTORY.LDX #<DOLSIGNJSR SETNAM ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR OPEN ;OPEN 8,8,0,"$"LDX #8    ;SET CHANNEL 8 FORJSR CHKIN ;INPUTLDY #6 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"AGAIN JSR CHRIN ;GET AND DISCARDDEY ;THE FIRST SIX BYTESBNE AGAIN ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR CHRIN ;MAKE THAT FIRST SEVEN.LDY #0 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LINE1 LDA MESS1,YBEQ HEADER ;PRINT MESSAGE NIMBERJSR CHROUT ;ONE TO THE SCREEN.INYBNE LINE1 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"HEADER LDY #12LDA #32 ; PRINT 12 SPACES ON SCREENINDENT JSR CHROUTDEY ;OR MOVE THE CRSR 12 SPACES.BNE INDENT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"NEXT1 JSR CHRINBEQ BOTTOM ;GET AND PRINT THEJSR CHROUT ;DIRECTORY HEADER & ID.BNE NEXT1 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"BOTTOM LDX #19LDY #4 ; SET THE CRSR ROW 19,CLC ;COLUMN 4.JSR PLOT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY #0LINE2 LDA MESS2,YBEQ SETCSR ;PRINT MESAGE NUMBER 2JSR CHROUT ;TO THE BOTTOM OF THEINY ;     SCREENBNE LINE2 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"SETCSR LDA $A3B3STA 2021LDA $A572 ;AUTHOR'S CREDITS HERESTA 2022LDA $A4A3STA 2023 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY #0 ;FILL THE FILENAME TABLE INTYA   ;MEMORY WITH ZEROS.CLRMEM STA TABLE,YINY   ;THIS JUST CLEARS IT FOR DATABNE CLRMEM ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDX #3 ;SET THE CRSR AT ROW 3LDY #0 ;AND COLUMN 0CLCJSR PLOT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #7STA COLORLDY #40LDA #"À" ;DRAW A LINE ACROSS THELINES JSR CHROUT ;       SCREEN.DEYBNE LINES ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #15STA COLORTITLES JSR CHRIN ;GET AND DISCARDJSR CHRIN ;THE LINE LINKS. A ZEROBNE SKIP10 ;HERE MEANS THE END OFLDA NOFILEBEQ SKIP11LDA CURLINSTA STPCNTCMP #4BNE SKIP6JMP INITSKIP6 LDA #1 ;FILE, SO SET EOF FLAGSTA DIRENDJMP PAUSE ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"SKIP10 JMP SEQCHK ; CHECK FOR SEQSKIP4 LDY #6LDA #32 ;PRINT SIX SPACESSPACES JSR CHROUTDEYBNE SPACES ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY INDEX3 ;GET AND PRINT THELDA TEMP2,Y ;NUMBER OF BLOCKSTAX ;USED BY THIS FILEINC INDEX3LDY INDEX3LDA TEMP2,YJSR LINPRT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #32 ;PRINT A SPACE. MAKES THEJSR CHROUT ;LISTING LOOK NEATNEXT INC INDEX3 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY INDEX3LDA TEMP2,Y ;GET A CHARACTERBEQ ENDLIN ;IF ZERO THEN EO LINEJSR CHROUT ;IF NOT  PRINT ITPHA ;STORE IT FOR A SEC.LDA FIRSTQ ;CHECK FOR 1ST " FLAGBEQ SKIP3 ;IF NOT SET-SKIP A LINEJMP STORNAM ;IF SET GO STORE ITSKIP11 LDX #8LDY #9CLCJSR PLOTLDY #0LOOP7 LDA MESS4,YBEQ SKIP12JSR CHROUTINYBNE LOOP7SKIP12 LDA MATRIXCMP #6BEQ GETMENUCMP #1BEQ NEWDISBNE SKIP12SKIP3 PLA ;GET CHARACTER BACKCMP #34 ;IS IT A "BNE LOOP1 ;IF NOT GO AROUND NEXTLDA #1 ;IF IT IS A " THEN SET THESTA FIRSTQ ;" FLAG.LOOP1 JMP NEXT ;GET NEXT CHARACTERENDLIN LDA #13 ;AT END OF THE LINEJSR CHROUT ;PRINT A <CR>.LDA INDEX1 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"CLC ;SET THE INDEXER TO THE STARTADC #17 ;OF THE NEXT FILENAME.STA INDEX1STA INDEX2 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA CURLIN ;CHECK THE CURRENT CRSRCMP #19 ;ROW. IF =>19 THEN PAUSEBCS PAUSE ;IF NOT THEN GET MOREJMP TITLES ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"PAUSE LDX #4LDY #12 ;SET THE CRSR TO ROW 4CLC ;COLUMN 12JSR PLOT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #0   ;SET THE OFFSET BACKSTA OFFSET ;TO ZERO.JSR REVERSE ;GO TO RVS PRINTNOTYET LDA MATRIX;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"CMP #7BEQ MOVCSR ;WAIT FOR USER INPUTCMP #1BEQ NEWDIS ;FROM THE KEYBOARDCMP #6BEQ GETMENU ;CRSR - F1 - F5 - F7CMP #3 ;OR THE RETURNBEQ NEXTPGCMP #4BEQ GETNAMEJMP NOTYET ;NO INPUTMOVCSR JMP CRSR1 ;CRSR KEY PRESSEDGETNAME JMP NAME1 ;F1 KEY PRESSEDNEWDIS JMP NOTHER ;RETURN PRESSEDGETMENU JMP MENU1 ;F5 KEY PRESSEDNEXTPG LDA DIREND ;F7 KEY PRESSEDBEQ SKIP7JMP DOOVER ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"SKIP7 LDX #4DOMORE JSR CLRLINE ;CLEAR SCREENINX  ;LINES FROM 4 TO 19CPX #19BNE DOMORE ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #0STA NDX ;CLEAR KEYBOARD BUFFER &STA INDEX1STA FIRSTQ ;SET VARIABLES TO ZEROSTA INDEX2STA NOLINE ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #146 ;TURN REVERSE PRINTJSR CHROUT ;       OFF.JMP SETCSR ;GO GET SOME MORE NAMESEND LDA #8 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR CLOSE ;AT END OF DIR CLOSE 8JSR CLALL ;RESTORE ALL I/O'SPLA ;    "ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"STA COLORPLA ;     RESTORE THE ORIGINALSTA EXTCOL ;SCREEN COLORS.PLASTA BGCOLO ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA #0 ;REMOVE ALL CRSR MOVEMENTSSTA NDX ;FROM THE BUFFER;JSR CLRSCN CLEAR THE SCREENRTS ;RETURNED TO CALLING PROGRAM;;--- END OF ROUTINE ---;FIRSTQ .BYTE 0INDEX1 .BYTE 0INDEX2 .BYTE 0 ;PROGRAM VARIABLESDIREND .BYTE 0 ;ARE STORED HERE.OFFSET .BYTE 0STPCNT .BYTE 0NOLINE .BYTE 0INDEX3 .BYTE 0TEMP2 .ASC "MI'S DIRECTORY  BY BOB K7 FOR MILADY";;--- SCREEN MESSAGES ---;MESS1 .ASC "    -> READING SEQ FILES ON DISK <- ’–":.BYTE 0MESS2 .ASC "ž’ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ".ASC "š         F1  : SELECT FILE NAME            ".ASC "      F5  : RETURN TO MENU              ".ASC "      F7  : SEE NEXT PAGE               ".ASC "     CRSR : SCROLL TO FILE              ".ASC "    RETURN: VIEW ANOTHER DISK":.BYTE 0MESS3 .ASC "’CHANGE DISK                      ".ASC " PRESS SPACE WHEN READY":.BYTE 0MESS4 .ASC "ž NO SEQ FILES FOUND ’":.BYTE 0;;--- SUB-ROUTINES ---;STORNAM PLA ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY INDEX2STA TABLE,Y ;THIS ROUTINE STORESCMP #34 ;CHARACTERS IN MEMORY--BNE SKIP2 ;CHECKS FOR & SETS THEINC NOLINE ;END OF NAME " FLAGLDA #0 ;AND INCREASES THE LINE #STA FIRSTQ ;TO THE NEXR LINESKIP2 INC INDEX2JMP LOOP1 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"REVERSE LDA #18 ;TURN RVS ONBNE SKIP5NORMAL LDA #146 ;   OR OFFSKIP5 JSR CHROUT ;   HERELDY OFFSET;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"NEXT2 LDA TABLE,YCMP #34 ;THIS ROUTINE CHANGES THEBEQ END1 ;LISTING THE CRSR IS ONJSR CHROUT ;TO RVS PRINT. ALSOINY ;CHANGES IT BACK TO NORMALBNE NEXT2 ;WHEN THE CRSR LEAVES.END1 RTS;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"CRSR1 LDX CURLINLDY #12 ;RETURN LISTING TO RVS OFFCLC ;WHEN CRSR IS MOVED TO NEXTJSR PLOT ;LINE.JSR NORMAL;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDA CURLINPHA  ;   CHECK TO SEE IF ANY LINESSEC  ;   LEFT IN LISTING.SBC #3CMP NOLINEBCS WAIT1 ;IF NOT SET UP THEPLA  ;CRSR TO THE NEXT FILENAMECLC  ;AND SET UP TO PRINT ITADC #1 ;IN REVERSETAXLDY #12JSR PLOTLDA OFFSETCLCADC #17     ;AND PRINT IT RVS.STA OFFSETJSR REVERSE ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"WAIT LDA MATRIX ;WAIT FOR KEY TOCMP #64 ;BE RELEASED.BNE WAIT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JMP NOTYET ;RETURN TO SELECT MENUWAIT1 PLA ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"WAIT2 LDA MATRIX ;WAIT FOR KEY TOCMP #64 ;BE RELEASED.BNE WAIT2 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JMP PAUSE ;BACK TO TOP OF LIST.NAME1 LDY OFFSET ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDX #0 ;COPIES SELECTED FILENAMELOOP3 LDA TABLE,Y ;FROM TABLE INSTA FILNAME,X ;MEMORY TO THECMP #34 ;LOCATION THAT BASIC CANBEQ END2 ;RETRIEVE IT FROM FORINY  ;USE IN THE MAIN PROGRAM.INXBNE LOOP3END2 JMP END ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"MENU1 LDA #34 ;SETS MENU FLAG FORSTA MENUFLG ;BASIC TO USE.JMP END ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"DOOVER LDX #4 ;CLEARS LINES 4OVER1 JSR CLRLINE ;THRU 19INXCPX #19BNE OVER1 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JMP INIT ;LIST DIR AGAIN FROM TOP.NOTHER LDA #8 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR CLOSE ;CLOSE 8JSR CLALL ;RESTORE ALL I/O'SJSR CLRSCN ;CLEAR THE SCREENLDA #0 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"STA BGCOLO ;BLACK OUT SCREEN FORSTA EXTCOL ;CHANGE DISK MESSAGELDA #7STA COLOR ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDX #7 ;POSITION THE CRSR FOR THELDY #13 ;CHANGE DISK MESSAGECLCJSR PLOT ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"LDY #0 ;PRINT THE CHANGE DISKLINE3 LDA MESS3,YBEQ WAIT3 ;MESSAGE NOW.JSR CHROUTINYBNE LINE3 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"WAIT3 LDA MATRIX ;WAIT FOR SPACECMP #60 ;BAR TO BE PRESSEDBNE WAIT3 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JMP START ;START OVER WHEN IT ISSEQCHK LDY #0 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JSR CHRIN ;GET AND STORE THE TWOSTA TEMP2,Y ;BYTES THAT MAKE UPINY ;THE BYTES USEDJSR CHRIN ;NUMBERSTA TEMP2,Y ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"INYLOOP5 JSR CHRIN ;GET AND STORE THESTA TEMP2,Y ;REST OF THE FILEBEQ SKIP8 ;NAMEINYBNE LOOP5 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"SKIP8 LDY #24 ;CHECK FOR A 'S'LOOP10 LDA TEMP2,Y ;IN THE 24THCMP #83 ;23RD OR 22ND SPOT WHICHBEQ SKIP9 ;INDICATES A SEQ FILEDEY ;THIS SPOT MOVES ACCORDINGCPY #21 ;TO THE # OF BLOCKS USEDBNE LOOP10 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"JMP TITLES ;NOT SEQ THEN GET NEXTSKIP9 LDA #0 ;"ÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀÀ"STA INDEX3 ;SET UP INDEX TO READLDA STPCNTBNE SKIP1INC NOFILESKIP1 JMP SKIP4 ;IN FILES & DO IT.